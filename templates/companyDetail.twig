{% extends "base.twig" %}
{% block content %}
<div class="w-100 row justify-between-content " style="max-height: var(--containertable-height);">
	<div class="card w-25">
		<table class="table" >
			<tbody>
				<tr><td><h4>{{company.razonSocial}}</h4><br><h6 id="textRutCompanieSelected">{{company.rut}}</h6>

					{% if company.estado == 7 or company.estado == 2 %}
					<span class="badge" style="background-color: #F44336">{{company.estadoDescripcion}}</span>
					{% elseif company.estado == 3 %}
					<span class="badge" style="background-color: #FF9800">{{company.estadoDescripcion}}</span>
					{% elseif company.estado == 4 or company.estado == 6 %}
					<span class="badge" style="background-color: #4CAF50">{{company.estadoDescripcion}}</span>
					{% elseif company.estado == 5 %}
					<span class="badge" style="background-color: blue">{{company.estadoDescripcion}}</span>
					{%endif%}

				</td></tr>
				<tr><td>
					<label>Sucursales</label><br>
					<select  id="selectBranchCompanieDetails" class="custom-select custom-select-sm shadow-sm" onchange="loadBranchCompanieData(this.value, {{company.rut}})">
					{% for suc in company.sucursales %}
					<option value="{{suc.codDGI}}">{{suc.nombreComercial}}</option>
					{% endfor %}
				</select></td></tr>

			</tbody>
		</table>
	</div>
	<div class="card w-75" >
		<div class="card-header bg-light">
			<div class="nav d-flex nav-pills bordered" id="v-pills-tab" role="tablist" aria-orientation="horizontal">
				<a class="btn  active" id="option-branch-data" data-toggle="pill" href="#branch-data" role="tab" aria-selected="true">Principal</a>
				<a class="btn " id="v-pills-profile-tab" data-toggle="pill" href="#caes-data" role="tab" aria-controls="v-pills-profile" aria-selected="false">CAES</a>
				<a class="btn " id="v-pills-profile-tab" data-toggle="pill" href="#resoluciones-data" role="tab" aria-controls="v-pills-profile" aria-selected="false">Resoluciones</a>
			</div>
		</div>
		<div class="card-body">
			<div class="tab-content">
				<!-- EMPRESA -->
				<div class="tab-pane fade active show" id="branch-data" role="tabpanel">
					<div class="containerTable">
						<form method="POST" id="formCompanieDetails">
				        	<table class="table">
				        		<tbody id="">
				        			<tr class="w-100">
				        				<td class="col-4">
											<label class="font-weight-bold">Sucursal principal</label>
				        				</td>
				        				<td>
					        				<div class="">
												<input type="checkbox" id="tdBranchDataPrincipal" name="branchPrincipal" class="" onchange="datachanged()" placeholder="Sucursal principal" />
											</div>
										</td>
									</tr>
									<tr class="w-100">
										<td class="col-4">
											<label class="font-weight-bold">Código DGI</label>
										</td>
										<td>
											<div class="">
												<input type="text" id="tdBranchDataCodDgi" name="codDgi" class="form__field" readonly placeholder="Código DGI" />
											</div>
										</td>
									</tr>
									<tr class="w-100">
										<td class="col-4">
											<label class="font-weight-bold">Estado</label>
				        				</td>
				        				<td>
						        			<select class="form__field" onchange="changestatusCompanie(this.value, {{company.estado}})">
													<option value="1">Pendiente usuario</option>
													<option value="2">Pendiente postulación</option>
													<option value="3">Pendiente aprobación</option>
													<option value="4">Pendiente certificación</option>
													<option value="5">Pendiente resolución</option>
													<option value="6">Emisor habilitado</option>
													<option value="7">Emisor no habilitado</option>
													<option value="8">En espera para comenzar</option>
											</select>
										</td>
									</tr>
								</tbody>
							</table>

							<br><br>

							<table class="table">
				        		<tbody id="tbodyCompaniesPrincipalData">

									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataNombre" name="nombre" class="form__field" onchange="datachanged()" placeholder="Nombre comercial" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<div class="pl-5 pb-1" id="tdBranchDataLogo"></div>
											<input type="file" onchange="datachanged()" name="logo" placeholder="Logo" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataDireccion" name="direccion" onchange="datachanged()" class="form__field" placeholder="Dirección" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataDepto" name="departamento" class="form__field" onchange="datachanged()" placeholder="Departamento" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataLocalidad" name="localidad" class="form__field" onchange="datachanged()" placeholder="Localidad" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataTel" name="telefono" class="form__field" onchange="datachanged()" placeholder="Teléfono 1" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataTel2" name="telefono2" class="form__field" onchange="datachanged()" placeholder="Teléfono 2" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataCorreo" name="correo" class="form__field" onchange="datachanged()" placeholder="Correo" />
										</div>
									</tr>
									<tr>
										<div class="form__group field">
											<input type="text" id="tdBranchDataWeb" name="sitio" class="form__field" onchange="datachanged()" placeholder="Sitio web" />
										</div>
									</tr>
									<tr>
										<div class="form__group field d-flex">
											<input type="color" id="tdBranchDataColorpicker" name="color1" onchange="changeColorpickerPrincipal(this.value)" class="form__field_colorpicker m-2">
											<input type="text" id="tdBranchDataColor" name="color1" class="form__field" onchange="changeColorpickerPrincipal(this.value)" placeholder="Color principal" />
										</div>
									</tr>
									<tr>
										<div class="form__group field d-flex">
											<input type="color" id="tdBranchDataColorpicker2" onchange="changeColorpickerSec(this.value)"  class="form__field_colorpicker m-2" name="color2">
											<input type="text" id="tdBranchDataColor2" name="color2" class="form__field" onchange="changeColorpickerSec(this.value)"  placeholder="Color secundario" />
										</div>
									</tr>
				        		</tbody>
				        	</table>


					        <div class="d-flex flex-row-reverse p-1">
								<button  id="buttonSubmitCompanieDetails" type="submit" class="btn btn-success" disabled>Guardar cambios</button>
					        </div>
				        </form>
			        </div>
				</div>
				<!-- CAES -->
				<div class="tab-pane fade" id="caes-data" role="tabpanel">
					<div class="containerTable" style="max-height: 30%;">
			        	<table class="table" id="tbodyCompaniesCaesData">
							<thead>
								<tr>
									<th>CFE</th>
									<th>Vencimiento</th>
									<th>Disponibles</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
			        </div>
				</div>
				<!-- RESOLUCIONES -->
				<div class="tab-pane fade" id="resoluciones-data" role="tabpanel">
					<div class="containerTable" style="max-height: 30%;">
			        	<table class="table">
							<thead>
								<tr>
									<th>Resolución</th>
									<th>Fecha</th>
								</tr>
							</thead>
							<tbody id="tbodyCompaniesResolucionesData" ></tbody>
						</table>
			        </div>
				</div>
			</div>
		</div>
	</div>
</div>

{% block script %}
<script type="text/javascript" src="{{ path_for('Start') }}scripts/companies.js{{ version }}"></script>
<script type="text/javascript" src="{{ path_for('Start') }}scripts/statusCompanies.js{{ version }}"></script>
<script type="text/javascript">
	$(document).ready(()=>{
		branchSelected = $("#selectBranchCompanieDetails").val();
		rutSelected = $("#textRutCompanieSelected").text();
		loadBranchCompanieData(branchSelected, rutSelected);

		loadCaesDetailsCompanies(rutSelected);

	});
</script>
{% endblock %}
{% endblock %}